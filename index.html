<script>
    const countries = [
        { name: "Уганда 🇺🇬", capital: "Кампала", population: "47 млн" },
        { name: "Казахстан 🇰🇿", capital: "Астана", population: "19 млн" },
        { name: "США 🇺🇸", capital: "Вашингтон", population: "333 млн" },
        { name: "Франция 🇫🇷", capital: "Париж", population: "68 млн" },
        { name: "Швейцария 🇨🇭", capital: "Берн", population: "8.7 млн" },
        { name: "Япония 🇯🇵", capital: "Токио", population: "125 млн" },
        { name: "Германия 🇩🇪", capital: "Берлин", population: "83 млн" },
        { name: "Великобритания 🇬🇧", capital: "Лондон", population: "67 млн" },
        { name: "Швеция 🇸🇪", capital: "Стокгольм", population: "10.5 млн" },
        { name: "Китай 🇨🇳", capital: "Пекин", population: "1.41 млрд" },
        { name: "Россия 🇷🇺", capital: "Москва", population: "146 млн" },
        { name: "Нигер 🇳🇪", capital: "Ниамей", population: "27 млн" },
        { name: "Беларусь 🇧🇾", capital: "Минск", population: "9.3 млн" },
        { name: "Бразилия 🇧🇷", capital: "Бразилиа", population: "215 млн" },
        { name: "Индия 🇮🇳", capital: "Нью-Дели", population: "1.42 млрд" },
        { name: "Конго 🇨🇬", capital: "Браззавиль", population: "6 млн" }
    ];

    const usedCountries = JSON.parse(localStorage.getItem("usedCountries") || "[]");
    const usedNumbers = JSON.parse(localStorage.getItem("usedNumbers") || "[]");

    let playerNumber = JSON.parse(localStorage.getItem("playerNumber"));
    let playerCountry = JSON.parse(localStorage.getItem("playerCountry"));

    function showPlayerInfo() {
        if (playerNumber && playerCountry) {
            document.getElementById("playerInfo").innerText =
                `📦 Номер: ${playerNumber}\n` +
                `🌍 Страна: ${playerCountry.name}\n` +
                `🏙️ Столица: ${playerCountry.capital}\n` +
                `👥 Население: ${playerCountry.population}`;
            document.getElementById("deleteBtn").disabled = false;
        }
    }

    function getRandomNumber() {
        const availableNumbers = [];
        for (let i = 1; i <= 1000; i++) {
            if (!usedNumbers.includes(i)) availableNumbers.push(i);
        }
        if (availableNumbers.length === 0) return null;
        return availableNumbers[Math.floor(Math.random() * availableNumbers.length)];
    }

    function getRandomCountry() {
        const available = countries.filter(c => !usedCountries.includes(c.name));
        if (available.length === 0) return null;
        return available[Math.floor(Math.random() * available.length)];
    }

    document.getElementById("getNumberBtn").onclick = () => {
        if (playerNumber && playerCountry) {
            document.getElementById("message").innerText = "🎉 У вас уже есть роль!";
            return;
        }

        const number = getRandomNumber();
        const country = getRandomCountry();

        if (!number || !country) {
            document.getElementById("message").innerText = "😢 Все страны и номера уже заняты!";
            return;
        }

        playerNumber = number;
        playerCountry = country;

        usedNumbers.push(number);
        usedCountries.push(country.name);

        // Сохраняем в localStorage
        localStorage.setItem("playerNumber", JSON.stringify(playerNumber));
        localStorage.setItem("playerCountry", JSON.stringify(playerCountry));
        localStorage.setItem("usedCountries", JSON.stringify(usedCountries));
        localStorage.setItem("usedNumbers", JSON.stringify(usedNumbers));

        showPlayerInfo();
        document.getElementById("message").innerText = "";
    };

    document.getElementById("deleteBtn").onclick = () => {
        if (playerNumber !== null && playerCountry !== null) {
            const indexNum = usedNumbers.indexOf(playerNumber);
            if (indexNum !== -1) usedNumbers.splice(indexNum, 1);

            const indexCountry = usedCountries.indexOf(playerCountry.name);
            if (indexCountry !== -1) usedCountries.splice(indexCountry, 1);

            // Удаляем из localStorage
            playerNumber = null;
            playerCountry = null;
            localStorage.removeItem("playerNumber");
            localStorage.removeItem("playerCountry");
            localStorage.setItem("usedCountries", JSON.stringify(usedCountries));
            localStorage.setItem("usedNumbers", JSON.stringify(usedNumbers));

            document.getElementById("playerInfo").innerText = "";
            document.getElementById("deleteBtn").disabled = true;
            document.getElementById("message").innerText = "✅ Удалено. Можете начать заново.";
        }
    };

    // При загрузке страницы
    showPlayerInfo();
</script>

